!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(1),a=r(i);!function(n,r,i){function a(){var e=new c;s.watch(e)}function u(){console.time("bench");for(var e=0;1e4>e;e++)a();console.timeEnd("bench")}var s=new r;i?i[n]=s:("undefined"!=typeof e&&e.exports&&(t=e.exports=s),t[n]=s);var c=function l(){var e=this;o(this,l),this.id=1,this.name="Tom",this.surname="Jarvis",this.fullName=function(){return e.name+" "+e.surname},this.async=function(){var t=e.name;return new Promise(function(e){setTimeout(function(){e(t+" async")},2e3)})},this.depFromAsync=function(){return e.async+" dependency!"},this.array=[1,2,3,4,5,6,7,8]};i.bench=u,i.test=s.watch(new c),s.eventStream.on("update",function(e){return console.log("update",e)})}("baxter",a["default"],window)},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;u=c=s=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(a)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=a,r=!0}},s=n(2),c=r(s),l=n(3),f=r(l),h=function(e){function t(e,n){o(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),Object.assign(this,n),this.length=n.length,this.eventStream=e}return i(t,e),a(t,[{key:"push",value:function(e){var n=u(Object.getPrototypeOf(t.prototype),"push",this).call(this,e);return this.eventStream.post("update",{uid:uid,owner:owner,key:key,value:this,type:"push",changed:this[n]}),n}},{key:"shift",value:function(){var e=u(Object.getPrototypeOf(t.prototype),"shift",this).call(this);return this.eventStream.post("update",{uid:uid,owner:owner,key:key,value:this,type:"shift",changed:e}),e}},{key:"pop",value:function(){var e=u(Object.getPrototypeOf(t.prototype),"pop",this).call(this);return this.eventStream.post("update",{uid:uid,owner:owner,key:key,value:this,type:"pop",changed:e}),e}},{key:"unshift",value:function(){for(var e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];var o=u(Object.getPrototypeOf(t.prototype),"unshift",this).apply(this,n);return this.eventStream.post("update",{uid:uid,owner:owner,key:key,value:this,type:"unshift",changed:n}),o}},{key:"reverse",value:function(){var e=u(Object.getPrototypeOf(t.prototype),"reverse",this).call(this);return this.eventStream.post("update",{uid:uid,owner:owner,key:key,value:this,type:"reverse",changed:e}),e}},{key:"sort",value:function(e){var n=u(Object.getPrototypeOf(t.prototype),"sort",this).call(this,e);return this.eventStream.post("update",{uid:uid,owner:owner,key:key,value:this,type:"sort",changed:n}),n}},{key:"splice",value:function(){for(var e=n.length,n=Array(e),r=0;e>r;r++)n[r]=n[r];var o=u(Object.getPrototypeOf(t.prototype),"splice",this).apply(this,n);return this.eventStream.post("update",{uid:uid,owner:owner,key:key,value:this,type:"splice",changed:o}),o}}]),t}(Array),v=function(){function e(){function t(e,t){var n;return function(){var r=function(){e(),n=null};clearTimeout(n),n=setTimeout(r,t)}}var n=this;o(this,e);var r=1;this.callstack=new Map,this.eventStream=new c["default"](this),this.utils={createObjectUID:function(e){var t=r++;return Object.defineProperty(e,"__uid__",{enumerable:!1,value:t}),t},getUIDByObject:function(e){return e.__uid__?e.__uid__:n.utils.createObjectUID(e)},createKeyUID:function(e,t){return n.utils.getUIDByObject(e)+":"+t}};var i=t(function(){n.eventStream.post("will-change-all")},20);this.eventStream.on("will-change",i)}return a(e,[{key:"subscribe",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?"update":arguments[3];if(!e||!t||!n)throw new f["default"]("can't subscribe variable without owner, key or callback function.");var o=this.utils.createKeyUID(e,t),i=["will-change","update"],a=-1!==i.indexOf(r)&&r;if(!a)throw new f["default"]("subscribe: listening "+r+" event is not accepted.");this.eventStream.on(a,function(e){e.uid===o&&n(e.value,e.oldValue)})}},{key:"resolve",value:function(e){var t=new Set,n=!0,r=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var u=i.value;t.add(this.callstack.get(u))}}catch(s){r=!0,o=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw o}}return Promise.all(t)}},{key:"getDependencies",value:function(e,t){this.eventStream.on("get",t);var n=e();return this.eventStream.off("get",t),new Promise(function(e){e(n)}).then(function(e){return e})}},{key:"addToStack",value:function(e,t,n){var r=this,o=this.utils.createKeyUID(e,t),i=function(e){r.callstack["delete"](o),r.callstack.size||r.eventStream.post("change-complete"),e()};this.eventStream.post("will-change",{uid:o,owner:e,key:t}),this.callstack.set(o,new Promise(function(e){r.eventStream.once("will-change-all",function(){var t=n();t instanceof Promise?t.then(function(){i(e)}):i(e)})}))}},{key:"observable",value:function(e,t,n){var r=this,o=n,i=this.utils.createKeyUID(e,t);return Object.defineProperty(e,t,{configurable:!0,set:function(n){return n===o?!1:void r.addToStack(e,t,function(){var a=o;o=n,r.eventStream.post("update",{uid:i,owner:e,key:t,value:o,oldValue:a})})},get:function(){return r.eventStream.post("get",{uid:i,owner:e,key:t,value:o}),o}}),o}},{key:"computed",value:function(e,t,n,r){var o=this,i=void 0,a=void 0,u=!1,s=this.utils.createKeyUID(e,t),c=!1,l=new Set;if(Symbol.iterator in Object(r)){var h=!0,v=!1,p=void 0;try{for(var d,y=r[Symbol.iterator]();!(h=(d=y.next()).done);h=!0){var w=d.value;handleObservable(w)}}catch(m){v=!0,p=m}finally{try{!h&&y["return"]&&y["return"]()}finally{if(v)throw p}}}return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.eventStream.post("get",{uid:s,owner:e,key:t,value:i}),i},set:function(n){if(!c)throw new f["default"]("you can't set value to computed");c=!1,i=n,o.eventStream.post("update",{uid:s,owner:e,key:t,value:i,oldValue:a})}}),this.getDependencies(n,function(r){if(r.uid===s)throw new f["default"]("Circular dependencies detected on "+t+" value.");l.add(o.utils.createKeyUID(r.owner,r.key)),o.subscribe(r.owner,r.key,function(){return u?!1:(o.addToStack(e,t,function(){return o.resolve(l).then(function(){return a=i,n.call(e)}).then(function(n){return u=!1,a===n?!1:(c=!0,void(e[t]=n))})}),void(u=!0))},"will-change")}).then(function(n){o.addToStack(e,t,function(){return o.resolve(l).then(function(){c=!0,e[t]=n})})}),i}},{key:"array",value:function(e,t,n){var r=this,o=this.utils.createKeyUID(e,t),i=new h(this.eventStream,n);return e[t]=i,Object.defineProperty(e,t,{configurable:!0,get:function(){return i},set:function(n){return r.eventStream.post("update",{uid:o,owner:e,key:t,value:n}),n}}),i}},{key:"watch",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];"function"==typeof n?this.computed(e,t,n):"[object Array]"===Object.prototype.toString.call(n)?this.array(e,t,n):this.observable(e,t,n)}return e}}]),e}();t["default"]=v,e.exports=t["default"]},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.channels=new Map,this.context=t||this}return r(e,[{key:"on",value:function(e,t){if(!e||!t)throw new Error("Can't init event listener: no parameters given");this.channels.has(e)||this.channels.set(e,new Set),this.channels.get(e).add(t)}},{key:"once",value:function(e,t){function n(o){return r.off(e,n),t(o)}if(!e||!t)throw new Error("Can't init event listener: no parameters given");var r=this;this.channels.has(e)||this.channels.set(e,new Set),this.channels.get(e).add(n)}},{key:"off",value:function(e,t){if(!e)throw new Error("Can't remove event listener: no event");if(!t)return this.channels["delete"](e);var n=this.channels.get(e);n["delete"](t),n.size||this.channels["delete"](e)}},{key:"post",value:function(e,t){var n=this;if(!e)throw new Error("Can't post undefined event");return this.channels.has(e)?("system:all"!==e&&this.post("system:all",{event:e,data:t}),new Promise(function(r){var o=!0,i=!1,a=void 0;try{for(var u,s=n.channels.get(e).values()[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var c=u.value;c.call(n.context,t)}}catch(l){i=!0,a=l}finally{try{!o&&s["return"]&&s["return"]()}finally{if(i)throw a}}r()})):new Promise(function(e){return e()})}},{key:"all",value:function(e){var t=this;this.on("system:all",function(n){e.call(t.context,n)})}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function o(e){return n(this,o),new Error("[Twin.js]: "+e)};t["default"]=r,e.exports=t["default"]}]);